import PyPDF2
import os


def open_log(log_file):
    log = open(log_file, 'a+')
    return log


def get_files(path):
    for fi in os.listdir(path):
        fp = os.path.join(path, fi)
        if os.path.isfile(fp):
            yield fp


def read_pdf(pdf_name):
    try:
        pdf_file = open(pdf_name, 'rb')
        pdf_reader = PyPDF2.PdfFileReader(pdf_file)
        return pdf_reader.getPage(0).extractText()
    except:
        print("Failed to parse : " + pdf_name)
        return None


if __name__ == '__main__':
    counter = 0
    log_file = open_log("H:\\IMP\\ENO.txt")
    for x in get_files("H:\\IMP\\PS2\\"):
        pdf_cont = read_pdf(x)
        if pdf_cont is None:
            continue
        line_sep = pdf_cont.split('\n')
        for s in line_sep:
            if "E No:-" in s:
                counter += 1
                s = s.replace("Director - Pay & RecordsE No:-", "")
                print(str(counter) + " : " + s)
                log_file.write(s + "\n")
                log_file.flush()

